<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ウェルビーイングと空間要素</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Klee+One:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4d4d4d; --accent-pos: #d4a373; --accent-neg: #457b9d;
            --bg: #FFFFFF; --card-bg: #ffffff; --text: #222; --border: #eeeeee;
            --rank-red: #e74c3c;
        }
        body { font-family: "Klee One", cursive, "Helvetica Neue", Arial, "Hiragino Sans", sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; overflow-x: hidden; }
        .container { max-width: 1400px; margin: 0 auto; padding: 40px 80px; }
        @media screen and (max-width: 767px) { .container { padding: 10px; } }
        
        header { border-bottom: 0px solid var(--primary); margin-bottom: 10px; padding-bottom: 20px; display: flex; flex-direction: column; }
        .header-top { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        
        .print-btn {
            background: var(--primary); color: #fff; padding: 10px 25px; font-size: 0.8rem;
            letter-spacing: 0.2em; cursor: pointer; border: none; transition: 0.3s; display: flex; align-items: center; gap: 10px;
        }
        .print-btn:hover { opacity: 0.8; transform: translateY(-2px); }

        .description-text { font-size: 1rem; font-weight: 600; color: #555; line-height: 1.8; margin-top: 20px; max-width: 1100px; white-space: pre-wrap; }
        .about-link { display: inline-block; margin-top: 10px; font-size: 0.9rem; color: var(--accent-pos); text-decoration: underline; cursor: pointer; }

        .config-panel { display: none; grid-template-columns: 350px 1fr; gap: 40px; background: white; padding: 30px; border: 1px solid var(--border); margin-bottom: 40px; }
        .target-section { display: flex; flex-direction: column; }
        
        /* Help Icon Style */
        .label-with-help { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
        .help-trigger { cursor: pointer; color: #000; transition: color 0.2s; display: inline-flex; align-items: center; }
        .help-trigger:hover { color: var(--accent-pos); }

        .filter-panel { border-left: 1px solid var(--border); padding-left: 40px; }
        .filter-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        
        label { display: block; font-size: 0.65rem; font-weight: bold; color: #888; text-transform: uppercase; }
        select { width: 100%; padding: 10px; border: 1px solid var(--border); font-size: 0.85rem; background: #fff; border-radius: 0; }
        .target-select { font-family: "Klee One", cursive; font-size: 1rem; font-weight: 300; background: #fafafa; border-bottom: 2px solid var(--primary); }

        .comparison-layout { display: none; grid-template-columns: 1fr 1fr; gap: 40px; }
        .column-header { text-align: center; margin-bottom: 20px; padding: 10px; background: var(--primary); color: white; letter-spacing: 0.2em; font-weight: 200; text-transform: uppercase; font-size: 1rem; }
        .n-badge { font-size: 0.7rem; color: #aaa; margin-top: 5px; }

        .card-grid { display: flex; flex-direction: column; gap: 12px; min-height: 400px; }
        .card { 
            background: var(--card-bg); border: 1px solid var(--border); 
            display: flex; flex-direction: row; align-items: center;
            opacity: 0; transform: translateY(20px);
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative; min-height: 100px;
        }
        .card.is-visible { opacity: 1; transform: translateY(0); }
        .card:hover { transform: translateX(5px); box-shadow: 0 5px 20px rgba(0,0,0,0.05); border-color: var(--primary); }

        .rank-badge { position: absolute; top: 8px; left: 10px; z-index: 10; font-family: 'Georgia', serif; font-weight: bold; color: var(--text); font-size: 1.1rem; opacity: 0.3; text-shadow: 0 0 8px rgba(255,255,255,1); }
        .card-visual { width: 160px; height: 100px; overflow: hidden; background: #f7f7f7; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .card-visual img { width: 100%; height: 100%; object-fit: cover; }
        .card-content { padding: 10px 25px; flex-grow: 1; display: flex; align-items: center; justify-content: space-between; gap: 20px; }
        .card-label { font-size: 1rem; font-weight: 600; line-height: 1.4; flex-grow: 1; margin: 0; }
        .card-footer { display: flex; flex-direction: column; align-items: flex-end; min-width: 100px; }
        .r-value { font-size: 1.8rem; font-weight: 200; font-family: 'Georgia', serif; line-height: 1; }
        .pos { color: var(--accent-pos); } .neg { color: var(--accent-neg); }
        .r-unit { font-size: 0.5rem; color: #aaa; text-transform: uppercase; margin-top: 4px; }

        .modal { 
            display: none; position: fixed; z-index: 3000; left: 0; top: 0; 
            width: 100%; height: 100%; background: rgba(0, 0, 0, 0.4); 
            overflow-y: auto; 
        }
        .modal-content { 
            max-width: 900px; margin: 40px auto; padding: 60px; 
            background: #ffffff; border: 1px solid #ddd; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.1); 
            line-height: 1.8; color: #333; text-align: justify; 
            position: relative;
        }
        .modal-content h2 { font-size: 1.5rem; font-weight: 300; margin-bottom: 40px; border-bottom: 1px solid #4d4d4d; padding-bottom: 15px; }
        .modal-content h3 { font-size: 1.1rem; font-weight: 300; margin-top: 40px; margin-bottom: 20px; color: var(--primary); border-left: 4px solid var(--accent-pos); padding-left: 15px; }
        .close-modal { position: absolute; right: 30px; top: 30px; cursor: pointer; font-size: 2rem; opacity: 0.5; }
        .close-modal:hover { opacity: 1; }

        @media (max-width: 1100px) { .comparison-layout, .config-panel { grid-template-columns: 1fr; } .filter-panel { border-left: none; padding-left: 0; border-top: 1px solid var(--border); padding-top: 20px; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="header-top">
            <h1 style="font-size: 1.6rem; font-weight: 300; letter-spacing: 0.1em; margin:0;">ウェルビーイングと空間要素</h1>
            <button class="print-btn" onclick="generatePreview()">
                <i data-lucide="printer" size="16"></i> PRINT
            </button>
        </div>
        <p class="description-text">本サイトは、「主観的ウェルビーイング」と「空間の構成要素」の相関係数をもとに可視化するツールです。</p>
        <span class="about-link" onclick="openAbout()">本ツール作成の背景と、私たちについて</span>
        <div class="title-row" style="margin-top:20px;">
            <div id="total-n" style="font-size: 0.8rem; font-weight: bold; letter-spacing: 0.1em;">TOTAL N = 0</div>
        </div>
    </header>

    <div class="config-panel" id="main-ui">
        <div class="target-section">
            <div class="label-with-help">
                <label>Target Psychology</label>
                <span class="help-trigger" onclick="openAboutAndScroll()" title="心理尺度について詳しく見る">
                    <i data-lucide="help-circle" size="10"></i>
                </span>
            </div>
            <select id="target-psychology" class="target-select" onchange="runSimulation()"></select>
        </div>
        <div class="filter-panel">
            <label>Attributes Filters</label>
            <div class="filter-grid" id="filters"></div>
        </div>
    </div>

    <div id="results-area" class="comparison-layout">
        <div class="column">
            <div class="column-header">住宅 <div class="n-badge" id="n-housing">N=0</div></div>
            <div class="card-grid" id="grid-housing"></div>
        </div>
        <div class="column">
            <div class="column-header">オフィス <div class="n-badge" id="n-office">N=0</div></div>
            <div class="card-grid" id="grid-office"></div>
        </div>
    </div>
</div>

<div id="aboutModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeAbout()">&times;</span>
        <h2>本ツール作成の背景と、ウェルビーイング空間設計プロジェクト（仮）について</h2>
         <h3>私たちについて</h3>

        <p>ウェルビーイング空間設計プロジェクト（仮）は、建築物を発注する人やデザインする人、施工する人、実際に使う人など、建築にかかわるすべての人が、そのプロセスやアウトプットにおいて「居心地のよさ」を感じられることを目指しています。</p>

        <p>周知の通り、建築物は、世の中にあるそのほかの製作物と同様に、それをつくるプロセスや使われていくあいだにおいて、さまざまな人や組織が関わっています。それぞれが役割を持ち、つくられ使われることで、社会が営まれています。</p>

        <p>現代社会において、ほとんどの活動が、建築物のなかで行われていることを考えると、良い社会をつくり、営むということにおいて、建築物は大きな責任を負っていると考えます。つまり、居心地よくつくられ、居心地よく使われる建築物というあり方を目指すことは、よりよい社会をつくることにつながると私たちは考えています。</p>



        <h3>建築設計や施工に関わる人々の「めやす」として</h3>

        <p>しかし、その「居心地のよい空間や建築物」を作り出すための明確な基準が、世の中にはまだありません。予算や敷地面積など限られた条件のなかで、建築要素の何を優先することが、「居心地のよさ」につながるのでしょうか。天井高でしょうか？それとも窓の大きさでしょうか？</p>

        <p>これまでは、デザイナーや設計者の経験値や施主の想いなどをもとにつくられてきた「居心地のよさ」ですが、それは時に「ひとりよがり」となり、真の「居心地のよさ」にはつながっていないケースもあると思われます。</p>

        <p>もちろん、「居心地のよさ」は個人の主観であり、数値的には測れないものがほとんどかもしれません。しかし、先ほども述べたとおり、建築物はたくさんの人がチームとなり、多様な技術や知識を結集してつくられます。そのプロセスにおいて、それぞれが多様な能力を発揮するための「めやす」のようなものの必要性を感じ、本プロジェクトがスタートしました。</p>

        <p>本ツールが、居心地のよいプロセスで作られた居心地のよい建築物をつくる一助となり、使う人の居心地のよい空間と時間、よりよい社会へとつながっていくことを願っています。</p>



        <h3>調査対象と方法</h3>

        <p>日常生活の中で室内の滞在時間の長い住宅とオフィスを対象に、主観的ウェルビーイングに影響する構成要素のアンケートを実施し（有効回答数1,040 名）、相関分析によって住宅79 項目、オフィス70 項目、因子分析によって、住宅7 因子、オフィス7 因子の主観的ウェルビーイングに影響する構成要素を明らかにしました。</p>

        <p>本ツールは明らかにした構成要素をもとに、建築空間の構成要素を定量的かつ網羅的、具体的に提示し、主観的ウェルビーイングを高める空間づくりの要素をシミュレーションできるツールとして開発しました。<br>

        <a href="#" style="color:var(--accent-pos);">本調査についての詳細はこちら</a></p>



        <h3>本ツールの使い方</h3>

        <ul>

            <li><strong>Target Psychology:</strong> 向上させたい心理的指標（幸福度、満足度、気分など）を選択します。</li>

            <li><strong>Attribute Filters:</strong> 対象となる居住者の性別、年代、居住地方を絞り込むことができます。</li>

            <li><strong>Residential / Office:</strong> 住宅とオフィスにおける各建築要素の相関係数が、高い順（プラスの相関）にランキング形式で表示されます。</li>

            <li><strong>相関係数（Correlation）:</strong> 0.1以上を相関あり、0.2以上を弱い相関、0.4以上を中程度の相関として解釈します。</li>

        </ul>



        <h3>本ツールで採用している心理尺度について</h3>

        <p><strong>・人生満足度尺度（SWLS）：</strong>Diener らが主観的幸福感を計る目的で開発したもので、比較的長いスパンにおける主観的幸福度を確認する尺度とされている。本調査では、以下5 項目について質問した。「ほとんどの面で、私の人生は私の理想に近い」「私の人生は、とてもすばらしい状態だ」「私は自分の人生に満足している」「私はこれまで、自分の人生に求める大切なものを得てきた」「もう一度人生をやり直せるとしても、ほとんど何も変えないだろう」</p>

        <p><strong>・ポジティブ感情（PA）/ ネガティブ感情（NA）：</strong>David Watson & Lee Anna Clark らが開発した気分評価尺度（日本語版PANAS）。ポジティブ感情「活気のある」「誇らしい」「強気な」等8項目、ネガティブ感情「びくびくした」「うろたえた」「心配した」等8項目の計16項目について、過去1ヶ月の体験を質問した。</p>

        <p><strong>・幸せの4因子：</strong>前野らが提唱する国内の幸福研究の主要概念。本調査では短縮版（8項目）を採用。「私は有能である」「私は社会・組織の要請に応えている」「私は人の喜ぶ顔が見たい」「私を大切に思ってくれる人たちがいる」等の項目について質問した。</p>




        <h3 style="border-left:none; padding-left:0; border-top:1px solid #eee; padding-top:20px;">【引用文献】</h3>

        <ul class="ref-list">

            <li>・Diener, E., Emmons, R. A., Larsen, R. J., and Griffin, S.:The satisfaction with life scale, Journal of PersonalityAssessment, 49(1),pp.71-75, 1985.</li>

            <li>・佐藤徳，安田朝子：日本語版PANASの作成，性格心理学研究，9 （2），pp.138-139，2001．</li>

            <li>・前野隆司：幸せのメカニズム 実踐・幸福学入門,講談社現代新書,2013</li>

        </ul>

    </div>

</div>

<script>
let masterData = [];
let columns = { attr: [], psych: [], arch: [] };

function openAbout() { document.getElementById('aboutModal').style.display = "block"; document.body.style.overflow = "hidden"; }
function closeAbout() { document.getElementById('aboutModal').style.display = "none"; document.body.style.overflow = "auto"; }

function openAboutAndScroll() {
    openAbout();
    setTimeout(() => {
        const element = document.getElementById('psych-scale-info');
        if (element) element.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
}

const PSYCH_COLS = [10, 11, 12, 13, 18, 19, 20, 21, 22, 23, 24, 25, 28, 29, 31, 34, 35, 44];
const ARCH_COLS = [51, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99];
const REGION_ORDER = ["北海道・東北地方", "関東地方", "中部地方", "近畿地方", "中国・四国・九州・沖縄地方"];

window.onload = function () {
    Papa.parse("data.csv", {
        download: true, header: false, dynamicTyping: true, skipEmptyLines: true,
        complete: function (results) {
            const raw = results.data;
            masterData = raw.slice(2);
            columns.attr = [2, 3, 4].map(idx => ({ idx, name: raw[0][idx] }));
            columns.psych = PSYCH_COLS.map(idx => ({ idx, label: raw[1][idx] || raw[0][idx] }));
            columns.arch = ARCH_COLS.map(idx => ({ idx, label: raw[1][idx] || raw[0][idx] }));
            setupFilters();
            setupPsychList();
            document.getElementById('main-ui').style.display = 'grid';
            document.getElementById('results-area').style.display = 'grid';
            
            // 【重要】ここでアイコンを描画する命令を実行
            lucide.createIcons();
            
            runSimulation();
        }
    });
};

// ... (以下、前回までのソート・計算・PDF生成関数をそのまま維持)
function setupFilters() {
    const container = document.getElementById('filters'); container.innerHTML = '';
    columns.attr.forEach(col => {
        let uniqueValues = [...new Set(masterData.map(d => d[col.idx]))].filter(v => v != null);
        if (col.idx === 4) { uniqueValues.sort((a, b) => REGION_ORDER.indexOf(a) - REGION_ORDER.indexOf(b)); }
        else { uniqueValues.sort(); }
        const div = document.createElement('div');
        div.innerHTML = `<label>${col.name}</label><select class="filter-select" data-idx="${col.idx}" onchange="runSimulation()"><option value="all">ALL</option>${uniqueValues.map(v => `<option value="${v}">${v}</option>`).join('')}</select>`;
        container.appendChild(div);
    });
}
function setupPsychList() { document.getElementById('target-psychology').innerHTML = columns.psych.map(p => `<option value="${p.idx}">${p.label}</option>`).join(''); }
function calculateCorrelation(data, x, y) {
    const subset = data.filter(d => typeof d[x] === 'number' && typeof d[y] === 'number');
    const n = subset.length; if (n < 2) return 0;
    let sX=0, sY=0, sXY=0, sX2=0, sY2=0;
    for(let i=0; i<n; i++) { let vX=subset[i][x], vY=subset[i][y]; sX+=vX; sY+=vY; sXY+=vX*vY; sX2+=vX*vX; sY2+=vY*vY; }
    const num = (n*sXY)-(sX*sY), den = Math.sqrt(((n*sX2)-(sX*sX))*((n*sY2)-(sY*sY)));
    return den===0 ? 0 : num / den;
}
function renderGrid(gridId, nId, data, targetIdx) {
    const grid = document.getElementById(gridId);
    const nDisplay = document.getElementById(nId);
    const results = columns.arch.map(a => ({ label: a.label, r: calculateCorrelation(data, targetIdx, a.idx) })).sort((a, b) => b.r - a.r);
    nDisplay.innerText = `N = ${data.length}`;
    grid.innerHTML = '';
    results.forEach((res, i) => {
        if (Math.abs(res.r) < 0.01) return;
        const card = document.createElement('div');
        card.className = 'card is-visible';
        card.innerHTML = `<div class="rank-badge">${i+1}</div><div class="card-visual"></div><div class="card-content"><div class="card-label">${res.label}</div><div class="card-footer"><span class="r-value ${res.r>=0?'pos':'neg'}">${res.r.toFixed(2)}</span><span class="r-unit">Correlation</span></div></div>`;
        grid.appendChild(card);
    });
}
function runSimulation() {
    const selects = document.querySelectorAll('.filter-select');
    let filteredTotal = masterData;
    selects.forEach(s => { if (s.value !== 'all') { const val = isNaN(s.value) ? s.value : Number(s.value); filteredTotal = filteredTotal.filter(d => d[s.dataset.idx] === val); }});
    const targetIdx = parseInt(document.getElementById('target-psychology').value);
    renderGrid('grid-housing', 'n-housing', filteredTotal.filter(d => d[9] === "住宅"), targetIdx);
    renderGrid('grid-office', 'n-office', filteredTotal.filter(d => d[9] === "オフィス"), targetIdx);
}
function generatePreview() { /* 前回のプレビュー関数をここに入れる */ }
</script>
</body>
</html>
